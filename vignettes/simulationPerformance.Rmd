---
title: "epiAllele performance on simulated data"
author: "Noah Dukler"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

In order to simulate data we must first create a tree. Note that the tree is unrooted.
```{r}
library(epiAllele)
library(ape)

set.seed(123)
### Create a tree
tr <- unroot(rtree(n = 10, br = runif))
plot(tr)
nodelabels()
tiplabels()
```

Say we want to simulate data where all edges below node 16 have rate 3 and all above have rate 1. To do so we construct a vector of rates with a one-to-one mapping to tree edges. We can then simulate data with the simData function whcih returns a list containing the tree, data, the stationary character distribution, an edge table, and a table that maps edgeGroups to rates.

```{r}
rates=rep(0.1,length(tr$edge.length))
rates[tr$edge[,2] %in% c(7:10,17:18)]=0.3
twoRateData=simData(nSites = 1000,tr=tr,rate = rates,pi = c(0.3,0.7))
```

Now we can place the data in an alleleData object and then a rateModel. We can check that the rate assignments are correct by plotting the rate model object.

```{r}
ad=alleleData(data = twoRateData$data,tree = tr)
twoRateMod=rateModel(ad,lineageTable = twoRateData$edgeTable)
plotTree(twoRateMod)
```
 
Now lets fit the model.

```{r}
fittedTRM=fit(twoRateMod)
plotTree(fittedTRM$model,"value")
```